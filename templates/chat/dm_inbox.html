<!DOCTYPE html>
<html>
<head>
    <title>Direct Messages</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        h1 { color: #333; }
        .conversation-list { list-style: none; padding: 0; }
        .conversation-item {
            border: 1px solid #ddd; padding: 15px; margin: 10px 0;
            border-radius: 5px; background: white; cursor: pointer;
        }
        .conversation-item:hover { background: #f5f5f5; }
        .other-user { font-weight: bold; font-size: 18px; color: #007bff; }
        .last-message { color: #666; margin: 5px 0; }
        .timestamp { color: #999; font-size: 12px; }
        .unread-badge {
            background: #dc3545; color: white; padding: 2px 8px;
            border-radius: 12px; font-size: 12px;
        }
        .new-dm-btn {
            display: inline-block; padding: 10px 20px; background: #28a745;
            color: white; text-decoration: none; border-radius: 5px; margin-bottom: 20px;
        }
        .new-dm-btn:hover { background: #218838; }
    </style>
</head>
<body>
 <a href="{% url 'chat:index' %}">Back to Rooms</a>

    <h1>Direct Messages</h1>
    <a href="{% url 'chat:user_list' %}" class="new-dm-btn">+ New Message</a>

    <ul class="conversation-list">
        {% for item in conversations %}
            <li class="conversation-item" onclick="window.location='{% url 'chat:dm_conversation' item.conversation.id %}'">
                <div class="other-user">
                    {{ item.other_user.username }}
                    {% if item.unread_count > 0 %}
                        <span class="unread-badge">{{ item.unread_count }}</span>
                    {% endif %}
                </div>
                {% if item.last_message %}
                    <div class="last-message">{{ item.last_message.content|truncatewords:10 }}</div>
                    <div class="timestamp">{{ item.last_message.timestamp|timesince }} ago</div>
                {% else %}
                    <div class="last-message">No messages yet</div>
                {% endif %}
            </li>
        {% empty %}
            <li>No conversations yet. <a href="{% url 'chat:user_list' %}">Start a new conversation</a></li>
        {% endfor %}
    </ul>


</body>
</html>